<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Verify OTP</title>
  <link rel="stylesheet" href="/css/style.css" />
</head>

<body class="auth-page">
  <main class="verify-layout">
    <section class="illustration-panel" aria-hidden="true">
      <div class="illustration-card">
        <div class="illustration-code">2 3 8 8</div>
        <div class="illustration-device">
          <div class="illustration-top"></div>
          <div class="illustration-screen">
            <div class="illustration-title">OTP Verification</div>
            <div class="illustration-text">Secure driver access</div>
            <div class="illustration-strip"></div>
          </div>
        </div>
      </div>
    </section>

    <section class="verify-panel">
      <header>
        <p class="eyebrow">OTP Verification</p>
        <h1>Enter your security code</h1>
        <p class="subhead">
          We sent a one-time password to your number. Please enter it below to continue.
        </p>
      </header>

      <% if (status) { %>
        <p class="message <%= status.type %> hero">
          <%= status.message %>
          <% if (status.expiresIn) { %>
            <span class="hint">Expires in <%= status.expiresIn %></span>
          <% } %>
        </p>
      <% } %>

      <form action="/verify-otp" method="post" class="login-form" novalidate>
        <label for="phoneNumber">Phone Number</label>
        <input
          id="phoneNumber"
          name="phoneNumber"
          type="tel"
          value="<%= phoneNumber %>"
          required
          readonly
        />

        <label for="otp">OTP Code</label>
        <div class="pin-board">
          <div class="pin-inputs" role="group" aria-label="OTP digits">
            <% for (let index = 0; index < 6; index++) { %>
              <input
                type="tel"
                inputmode="numeric"
                pattern="\\d"
                maxlength="1"
                class="pin-digit"
                aria-label="Digit <%= index + 1 %>"
              />
            <% } %>
          </div>
          <input type="hidden" name="otp" id="otpValue" required />
          <p class="otp-note">Enter the 6-digit code we sent to <strong><%= phoneNumber %></strong></p>
          <p class="otp-note-light">Paste it here or type each digit manually.</p>
        </div>

        <button type="submit" class="primary-btn">Verify &amp; Login</button>
      </form>

      <div class="verify-footer">
        <a class="muted-link" href="/forgot-password">Didn't receive OTP? Resend code</a>
        <a class="muted-link" href="/login">Change phone number</a>
      </div>
    </section>
  </main>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.querySelector(".login-form");
      const inputs = Array.from(document.querySelectorAll(".pin-digit"));
      const otpValue = document.getElementById("otpValue");

      const joinDigits = () => inputs.map((input) => input.value.trim()).join("");

      inputs.forEach((input, idx) => {
        input.addEventListener("input", (event) => {
          const digit = event.target.value.replace(/\\D/g, "");
          event.target.value = digit.slice(-1);

          if (digit && idx < inputs.length - 1) {
            inputs[idx + 1].focus();
          }

          otpValue.value = joinDigits();
        });

        input.addEventListener("keydown", (event) => {
          if (event.key === "Backspace" && !input.value && idx > 0) {
            inputs[idx - 1].focus();
          }
        });
      });

      inputs[0]?.focus();

      form?.addEventListener("submit", () => {
        otpValue.value = joinDigits();
      });
    });
  </script>
</body>

</html>
